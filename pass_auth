CREATE OR REPLACE PROCEDURE verify_user_password (
    p_username IN VARCHAR2,
    p_password IN VARCHAR2
) AS
    v_stored_hash RAW(32);
    v_input_hash  RAW(32);
BEGIN
    -- Generate hash of the input password
    v_input_hash := DBMS_CRYPTO.HASH(UTL_I18N.STRING_TO_RAW(p_password, 'AL32UTF8'), DBMS_CRYPTO.HASH_SH256);

    -- Fetch the stored hash from the database
    SELECT password_hash INTO v_stored_hash
    FROM users_credentials
    WHERE username = p_username;

    -- Compare the two hashes
    IF v_stored_hash = v_input_hash THEN
        DBMS_OUTPUT.PUT_LINE('Password matched successfully.');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Incorrect password.');
    END IF;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Username not found.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
